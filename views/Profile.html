<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account Created Successfully</title>
    <style>
      /* Previous styles remain mostly the same, adding/enhancing these */
    </style>
  </head>
  <body>
    <!-- Navbar (unchanged) -->
    <nav class="navbar">
      <!-- Previous navbar content -->
    </nav>

    <div class="container">
      <h1>Account Created Successfully!</h1>

      <div class="profile">
        <h2>Your Profile</h2>
        <div class="profile-info">
          <strong>Full Name:</strong>
          <span id="profile_name" class="loading">Loading...</span>
          <strong>Email:</strong>
          <span id="profile_email" class="loading">Loading...</span>
          <strong>Username:</strong>
          <span id="profile_username" class="loading">Loading...</span>
          <strong>Member Since:</strong>
          <span id="profile_created" class="loading">Loading...</span>
        </div>
        <div class="profilePhoto">
          <img
            id="profile_photo"
            src="/images/placeholder.jpg"
            alt="Profile Photo"
          />
        </div>
      </div>

      <!-- Rest of the content (booking form, appointment details, buttons) remains same -->
    </div>

    <!-- Footer (unchanged) -->
    <!-- In your HTML file -->
    <script>
      // Store token in localStorage after login/signup
      async function handleLoginOrSignup(email, password) {
        try {
          const response = await fetch("http://localhost:4000/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();
          if (response.ok) {
            localStorage.setItem("token", data.token);
            window.location.href = "/profile"; // Redirect to profile page
          } else {
            alert(data.errors[0].msg);
          }
        } catch (error) {
          console.error("Login error:", error);
        }
      }

      async function fetchUserProfile() {
        const token = localStorage.getItem("token");
        if (!token) {
          window.location.href = "/login";
          return;
        }

        try {
          const response = await fetch(
            "http://localhost:4000/api/auth/profile",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("Failed to fetch profile");
          }

          const userData = await response.json();

          document.getElementById("profile_name").textContent =
            userData.name || "Not provided";
          document.getElementById("profile_email").textContent =
            userData.email || "Not provided";
          document.getElementById("profile_username").textContent =
            userData.username || userData.email.split("@")[0];
          document.getElementById("profile_created").textContent = new Date(
            userData.createdAt
          ).toLocaleDateString();
          document.getElementById("profile_photo").src =
            userData.photoUrl || "/images/placeholder.jpg";

          document.querySelectorAll(".loading").forEach((element) => {
            element.classList.remove("loading");
          });
        } catch (error) {
          console.error("Error fetching profile:", error);
          window.location.href = "/login";
        }
      }

      async function checkAuth() {
        const token = localStorage.getItem("token");
        if (!token) {
          window.location.href = "/login";
          return;
        }

        try {
          const response = await fetch("http://localhost:4000/api/auth/check", {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (!response.ok) {
            localStorage.removeItem("token");
            window.location.href = "/login";
          } else {
            fetchUserProfile();
          }
        } catch (error) {
          console.error("Auth check failed:", error);
          window.location.href = "/login";
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        checkAuth();
        // Your existing event listeners...
      });
    </script>
  </body>
</html>
